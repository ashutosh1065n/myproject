<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Professional fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=IBM+Plex+Sans:wght@400;600&display=swap" rel="stylesheet">

  <!-- External CSS (served by Flask static/) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  <!-- Chart.js (must load before your script.js) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- App Bar -->
  <div class="appbar">
    <div class="row">
      <div class="brand">
        <h1>Human Multi-Disease Diagnostic Prediction Model</h1>
        <small>Evidence-aware • Age-conditioned • Probability driven</small>
      </div>
      <div class="row">
        <button class="btn ghost" id="pdfBtn" type="button" style="display:none;">Save as PDF</button>
        <form action="{{ url_for('logout') }}" method="get" style="display:inline;">
          <button type="submit" class="btn ghost" style="margin-left:8px;">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <div class="shell">
    <div class="grid">

      <!-- Left: Patient + Symptoms -->
      <aside class="card">
        <div class="welcome-message">
          <h2 style="color: #dc2626; font-weight:800;">Welcome, {{ patient_name }} !</h2>
        </div>
        <h2>Patient Details</h2>

        <div class="field">
          <label class="label" for="age">Age</label>
          <input id="age" name="age" type="number" min="0" max="100" class="input" placeholder="Enter age (e.g., 27)" />
        </div>

        <div class="field">
          <label class="label" for="symSearch">Search</label>
          <input id="symSearch" class="search" placeholder="Filter symptoms (fever, cough, nausea…)" />
        </div>

        <!-- Category chips -->
        <div class="field">
          <div class="label">Categories</div>
          <div class="filters" id="categories">
            <button class="chip" data-cat="all" aria-pressed="true" type="button">All</button>
            <button class="chip" data-cat="fever" type="button">Fever / Inflammation</button>
            <button class="chip" data-cat="resp" type="button">Respiratory</button>
            <button class="chip" data-cat="gi" type="button">Gastrointestinal</button>
            <button class="chip" data-cat="neuro" type="button">Neurological</button>
            <button class="chip" data-cat="pain" type="button">Pain / Fatigue</button>
            <button class="chip" data-cat="skin" type="button">Dermatologic</button>
            <button class="chip" data-cat="general" type="button">General</button>
          </div>
        </div>

        <div id="symptomBox" class="sym-grid" aria-live="polite">
          <div class="hint">Type age to load symptoms</div>
        </div>

        <div class="actions">
          <button class="btn" id="predictBtn" type="button">Predict</button>
          <button class="btn muted" id="resetBtn" type="button">Reset</button>
          <div class="status" id="selCount">0 selected</div>
        </div>
      </aside>

      <!-- Right: Insights -->
      <section class="panes">

        <!-- Predictions panel -->
        <div class="card">
          <h2>
            Prediction
            <span class="sub" id="statusLine" style="font-size:.9rem; color:var(--muted); font-weight:700">Awaiting age to load symptoms</span>
          </h2>

          <!-- Summary metrics -->
          <div class="summary">
            <div class="metric">
              <div class="sub">Age Group</div>
              <div class="k" id="ageGroupK">—</div>
            </div>
            <div class="metric">
              <div class="sub">Symptoms selected</div>
              <div class="k" id="symCountK">0</div>
            </div>
            <div class="metric">
              <div class="sub">Care Domain</div>
              <div class="k" id="modelNameK">—</div>
            </div>
          </div>

          <!-- Severity -->
          <div id="severityCard" class="severity" style="display:none;">
            <div id="sevBadge" class="sev-badge sev-mild">Mild</div>
            <div>
              <div id="sevTitle" style="font-weight:800; margin-bottom:4px;">Top Disease: —</div>
              <div id="sevDetail" class="sub" style="color:var(--muted)">Probability: —</div>
            </div>
          </div>

          <!-- NEW: Top disease description -->
          <div id="diseaseDescription" style="margin-top:10px; color:var(--ink); font-weight:600;"></div>

          <!-- Top 4 table -->
          <h2 style="margin-top:16px;">Other Possible Diagnoses</h2>
          <table id="resultTable" aria-label="Top 4 predicted diseases">
            <thead><tr><th>Disease</th><th>Probability</th></tr></thead>
            <tbody><tr><td colspan="2" class="sub" style="color:var(--muted)">No results yet.</td></tr></tbody>
          </table>
        </div>

        <!-- Probability chart -->
        <div class="card">
          <h2>Probability Breakdown</h2>
          <div class="chart-wrap">
            <canvas id="donutChart" height="320" aria-label="Probability doughnut chart"></canvas>
          </div>
        </div>

        <!-- Care Guidance Section -->
        <div class="card" id="care-guidance" style="display:none; grid-column: 1 / -1; padding:10px 12px;">
          <h2 style="font-size:1.05rem; text-align:center; margin:0 0 6px; color:#0b4c74;">
            Care Guidance
          </h2>

          <!-- Buttons row -->
          <div style="display:flex; justify-content:center; gap:24px; margin:6px 0 6px;">
            <button id="remedies-btn" class="btn" style="display:none; padding:6px 14px; font-size:.90rem;">Home Remedies</button>
            <button id="suggestion-btn" class="btn muted" style="display:none; padding:6px 14px; font-size:.90rem;">Suggestions</button>
          </div>

          <!-- Compact output box -->
          <div id="care-output"
               style="display:none; padding:8px 10px 0px; background:#fafafa; border-radius:8px; border:1px solid var(--border);
                      font-size: 1.05rem; line-height:1.4; font-weight:500;">
          </div>
        </div>

        <div class="card" id="recovery-card" style="display:none; grid-column: 1 / -1; padding:10px 12px;">
          <h2 style="font-size:1.05rem; text-align:center; margin:0 0 6px; color:#0b4c74;">
            Recovery Timeline
          </h2>
          <div style="text-align:center; margin:6px 0;">
            <button id="recoveryBtn" class="btn muted" style="padding:6px 14px; font-size:.90rem;">
              Expected Recovery
            </button>
          </div>
          <div id="recoveryOutput"
               style="display:none; margin-top:8px; padding:8px 10px; background:#fafafa;
                      border-radius:8px; border:1px solid var(--border);
                      font-size: 1rem; font-weight:600; text-align:center;">
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- External JS (served by Flask static/) -->
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
